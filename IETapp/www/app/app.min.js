window.addEventListener("load",function(){new FastClick(document.body)},!1);var IET=angular.module("IET",["ngRoute","ngCordova","ngAnimate","ngTouch"]);IET.controller("MainCtrl",function($scope,$rootScope,$http,$cordovaNativeAudio){document.addEventListener("deviceready",function(){console.log("deviceready"),$cordovaNativeAudio.preloadSimple("tick","sounds/tick.wav"),$cordovaNativeAudio.play("click"),console.log("end deviceready")},!1),$rootScope.animDir=!1,$rootScope.flagSound=!1,$rootScope.context=new window.webkitAudioContext,$rootScope.getSound=new XMLHttpRequest,$rootScope.source,$rootScope.soundURL=function(url){$rootScope.getSound.open("GET",url,!0),$rootScope.getSound.responseType="arraybuffer"},$rootScope.playBuffer=function(buffer){$rootScope.context.close(),$rootScope.context=new window.webkitAudioContext,$rootScope.source=$rootScope.context.createBufferSource(),$rootScope.source.buffer=buffer,$rootScope.source.connect($rootScope.context.destination),$rootScope.source.start(0)},$rootScope.keyboardNotes=[];for(key in notes)$rootScope.keyboardNotes[key]=new Audio("sounds/piano/"+notes[key]+".wav");$rootScope.stopOSC=function(){$rootScope.flagSound=!1},$rootScope.IETscore=localStorage.getItem("IETscore")?JSON.parse(localStorage.getItem("IETscore")):[],console.log($rootScope.IETscore)}),IET.config(["$routeProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"app/views/home/home.tpl.html",controller:"HomeCtrl"}).when("/training-menu",{templateUrl:"app/views/training-menu/training-menu.tpl.html",controller:"TrainingMenuCtrl"}).when("/training/:major/:minor/:bool",{templateUrl:"app/views/training/training.tpl.html",controller:"TrainingCtrl"}).when("/test",{templateUrl:"app/views/test/test.tpl.html",controller:"TestCtrl"}).when("/score",{templateUrl:"app/views/score/score.tpl.html",controller:"ScoreCtrl"}).when("/keyboard",{templateUrl:"app/views/keyboard/keyboard.tpl.html",controller:"KeyboardCtrl"}).when("/metronome",{templateUrl:"app/views/metronome/metronome.tpl.html",controller:"MetronomeCtrl"}).otherwise({redirectTo:"/"})}]).directive("ngNextButton",function($document){return{link:function(scope,element,attr){element.on("click",function(){$("button.ok").removeClass("ok"),$("button.ko").removeClass("ko")})}}}),IET.controller("HomeCtrl",function($scope,$rootScope,$timeout){}),IET.controller("MetronomeCtrl",function($scope,$rootScope,$routeParams,$interval,$timeout,$http){$scope.tempoValue=120,$scope.flagMetronome=!1,$scope.flagTap=!1,$scope.tap1=0,$scope.tap2=0,$scope.date,$scope.playNote=function(){$rootScope.flagSound=!0,$rootScope.soundURL("sounds/tick.wav"),$rootScope.getSound.onload=function(){$rootScope.context.decodeAudioData($rootScope.getSound.response,function(buffer){$rootScope.playBuffer(buffer)},function(error){console.error(error)})},$rootScope.getSound.send()},$scope.setTempoValue=function(tempo){$scope.tempoValue=tempo},$scope.playMetronome=function(tempo){$scope.flagMetronome=!0,$interval.cancel($scope.interval),$timeout.cancel($scope.timeout),$scope.interval=$interval(function(){$scope.playNote()},6e4/parseInt(tempo))},$scope.stopMetronome=function(){$scope.flagMetronome===!0&&($rootScope.source.disconnect($rootScope.context.destination),$scope.flagMetronome=!1,$rootScope.flagSound=!1,$interval.cancel($scope.interval),$timeout.cancel($scope.timeout))},$scope.tapTempo=function(){$scope.flagMetronome===!0&&$rootScope.source.disconnect($rootScope.context.destination),$scope.date=new Date,$scope.tap1=$scope.tap2,$scope.tap2=$scope.date,$scope.subTap=$scope.tap2-$scope.tap1,$scope.results=parseInt(6e4/$scope.subTap),0!==$scope.tap1&&$scope.results>34&&$scope.results<226&&($scope.tempoValue=$scope.results,$scope.tempoChange($scope.tempoValue))},$scope.tempoChange=function(tempo){$scope.flagMetronome?$scope.playMetronome(tempo):$scope.setTempoValue(tempo)}}),IET.controller("ScoreCtrl",function($scope,$rootScope){$scope.items=$rootScope.IETscore,0===$rootScope.IETscore.length?$scope.showItems=!1:$scope.showItems=!0}),IET.controller("KeyboardCtrl",function($scope,$rootScope){$scope.playNote=function(note){for(key in notes)note===key&&($rootScope.keyboardNotes[key].pause(),$rootScope.keyboardNotes[key].currentTime=0,$rootScope.keyboardNotes[key].play())}}).directive("ngTouch",function($rootScope){return{link:function(scope,element,attr){element.on("touchstart",function(){scope.playNote(attr.id)})}}}),IET.controller("TrainingCtrl",function($scope,$rootScope,$routeParams,$timeout){$scope.Major=$routeParams.major,$scope.minor=$routeParams.minor,$scope.direction=$routeParams.bool,$scope.bool1,$scope.bool2,$scope.note1,$scope.note2,$scope.score=0,$scope.step=1,$scope.snd,$scope.playNote=function(note){$rootScope.flagSound=!0;for(key in notes)note===key&&($rootScope.keyboardNotes[key].currentTime=0,$rootScope.keyboardNotes[key].play())},$scope.randNum=function(){var rand=14+14*Math.random();return rand=Math.floor(rand)},$scope.playInterval=function(note,interval,direction){$scope.interval=parseInt(interval)+1,$scope.Note=Object.keys(notes)[note],"none"!==direction&&(direction="true"===direction?Boolean(direction):!Boolean(direction)),"none"===direction?($scope.playNote($scope.Note),$scope.playNote(Object.keys(notes)[note+$scope.interval])):($scope.playNote($scope.Note),$timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){direction===!0?$scope.playNote(Object.keys(notes)[note+$scope.interval]):$scope.playNote(Object.keys(notes)[note-$scope.interval])},1e3))},$scope.playTrainingInterval=function(Maj,min,bool,note){note?$scope.note=$scope.note1:$scope.note=$scope.note1=$scope.randNum(),$scope.bool1=Math.random()<.5?Maj:min,$scope.bool2=$scope.bool1!=Maj?Maj:min,$scope.playInterval($scope.note,$scope.bool1,bool),$scope.timeout=$timeout(function(){$scope.playInterval($scope.note,$scope.bool2,bool),$scope.timeout2=$timeout(function(){$rootScope.flagSound=!1},3e3)},3e3)},$scope.playTraining=function(Maj,min,bool,note){10!=$scope.step?($scope.showNext=!1,$scope.playTrainingInterval(Maj,min,bool,note)):($scope.showReplay=!1,$scope.showNext=!1,$scope.showAnswer=!1,$scope.showPopin=!0),$scope.step<11?$scope.step+=1:$scope.step=10}}).directive("ngAnswerOne",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){$timeout.cancel(scope.timeout),$rootScope.stopOSC(),scope.bool1===scope.Major?(element.addClass("ok"),scope.score+=1):element.addClass("ko")})}}}).directive("ngAnswerTwo",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){$timeout.cancel(scope.timeout),$rootScope.stopOSC(),scope.bool2===scope.Major?(element.addClass("ok"),scope.score+=1):element.addClass("ko")})}}}),IET.controller("TrainingMenuCtrl",function($scope,$rootScope,$timeout){$scope.showPopin=!1}),IET.controller("TestCtrl",function($scope,$rootScope,$routeParams,$timeout){$scope.Major=$routeParams.major,$scope.minor=$routeParams.minor,$scope.direction=$routeParams.bool,$scope.bool1,$scope.bool2,$scope.note1,$scope.note2,$scope.score=0,$scope.step=1,$scope.playNote=function(note){$rootScope.flagSound=!0;for(key in notes)note===key&&($rootScope.keyboardNotes[key].currentTime=0,$rootScope.keyboardNotes[key].play())},$scope.randNum=function(){var rand=14+14*Math.random();return rand=Math.floor(rand)},$scope.playInterval=function(note1,note2){$scope.playNote(Object.keys(notes)[note1]),$timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){$rootScope.flagSound=!1,$scope.playNote(Object.keys(notes)[note2]),$scope.timeout2=$timeout(function(){$rootScope.flagSound=!1},1e3)},1e3)},$scope.playTrainingInterval=function(note1,note2){$scope.note1=note1?note1:$scope.randNum(),$scope.note2=note2?note2:$scope.randNum(),$scope.interval=$scope.note1>=$scope.note2?$scope.note1-$scope.note2:$scope.note2-$scope.note1,console.log($scope.note1+" - "+$scope.note2+" = "+$scope.interval),$scope.playInterval($scope.note1,$scope.note2)},$scope.playTraining=function(){10!=$scope.step?($scope.showNext=!1,$scope.playTrainingInterval()):($scope.showReplay=!1,$scope.showNext=!1,$scope.showAnswer=!1,$scope.showPopin=!0,$scope.d=new Date,$scope.today=$scope.d.getDate()+1<10?"0"+parseInt($scope.d.getDate()):parseInt($scope.d.getDate()),$scope.month=$scope.d.getMonth()+1<10?"0"+(parseInt($scope.d.getMonth())+1):parseInt($scope.d.getMonth())+1,$scope.actualScore={date:$scope.today+"/"+$scope.month+"/"+$scope.d.getFullYear()+" - "+$scope.d.toLocaleTimeString(),score:$scope.score},console.log($scope.actualScore),$rootScope.IETscore.push($scope.actualScore),localStorage.removeItem("IETscore"),localStorage.setItem("IETscore",angular.toJson($rootScope.IETscore)),console.log($rootScope.IETscore)),$scope.step<11?$scope.step+=1:$scope.step=10}}).directive("ngAnswerUnison",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){0===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerSecondMinor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){1===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerSecondMajor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){2===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerThirdMinor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){3===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerThirdMajor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){4===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerFourth",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){5===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerTriton",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){6===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerFifth",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){7===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerSixthMinor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){8===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerSixthMajor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){9===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerSeventhMinor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){10===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerSeventhMajor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){11===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerOctave",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){12===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerNinthMinor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){13===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}}).directive("ngAnswerNinthMajor",function($rootScope,$timeout){return{link:function(scope,element,attr){element.on("click",function(){14===scope.interval?(element.addClass("ok"),scope.score+=1):(element.addClass("ko"),$("button[data-interval="+scope.interval+"]").addClass("ok")),$timeout.cancel(scope.timeout),$rootScope.stopOSC()})}}});